---
import { Github, Linkedin, Mail } from "lucide-astro";
import Layout from "../layouts/Layout.astro";

const rgpdCerts = import.meta.glob("../assets/certifications/RGPD*.pdf", { eager: true });
const rgpdUrls = Object.values(rgpdCerts).map((mod: any) => mod.default);

const socials = [
  { label: "LinkedIn", icon: Linkedin, link: "https://www.linkedin.com/in/esteban-rattier-226688342/" },
  { label: "GitHub", icon: Github, link: "https://github.com/Kaz-OS" },
  { label: "Mail", icon: Mail, link: "mailto:esteban.rattier@campus-la-chataigneraie.org" },
];
---

<Layout>
  <main>
    <section class="profil">
      <h1>Profil</h1>
      <p>
        Étudiant en informatique. Actuellement à la recherche d'un stage de 5 semaines (du ??? au ???) en développement pour valider ma 2e année de BTS Services Informatiques aux Organisations (SIO).
      </p>
    </section>
    <div class="icones">
      {
        socials.map((social) => (
          <a href={social.link} target="_blank">
            <social.icon />
          </a>
        ))
      }
    </div>
  </main>
  <h1>Expériences</h1>
  <section class="Expériences">
    <div class="experience-grid">
      <div class="experience-card">
        <h2>GORON ASSI</h2>
        <p class="role">Technicien stagiaire</p>
        <ul>
          <li><strong>Durée:</strong> 4 semaines</li>
          <li>Gestion de réseaux</li>
        </ul>
      </div>
      <div class="experience-card">
        <h2>DSEM</h2>
        <p class="role">Technicien stagiaire</p>
        <ul>
          <li><strong>Durée:</strong> 4 semaines</li>
          <li>Maintenance d'équipement électronique</li>
        </ul>
      </div>
      <div class="experience-card">
        <h2>PC Solution 76</h2>
        <p class="role">Technicien stagiaire</p>
        <ul>
          <li><strong>Durée:</strong> 8 semaines</li>
          <li>Maintenance d'équipement électronique</li>
        </ul>
      </div>
      <div class="experience-card">
        <h2>Sery OUEST</h2>
        <p class="role">Technicien stagiaire</p>
        <ul>
          <li><strong>Durée:</strong> 6 semaines</li>
          <li>Imprimerie numérique</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Section Formation ajoutée -->
  <section class="Formation">
    <h1>Formation</h1>
    <div class="formation-grid">
      <div class="formation-card">
        <h2>BTS SIO (2<sup>e</sup> année)</h2>
        <p class="etab">La Châtaigneraie</p>
        <p class="annee">2023 - 2025</p>
      </div>
      <div class="formation-card">
        <h2>Bac Pro Systèmes Numériques</h2>
        <p class="etab">La Châtaigneraie</p>
        <p class="annee">2020 - 2023</p>
      </div>
      <div class="formation-card">
        <h2>Brevet des collèges</h2>
        <p class="etab">Collège Henri Laugier</p>
        <p class="annee">2016 - 2020</p>
      </div>
    </div>
  </section>

  <!-- Section Certifications -->
  <section class="Certifications">
    <h1>Certifications</h1>
    <div class="certif-grid">
      <article class="certif-card" id="rgpd-card" style="cursor: pointer;">
        <img src="/attestations/rgpd.png" alt="Certification RGPD — Règlement général sur la protection des données" loading="lazy" width="300" height="197" />
        <h3>RGPD (Cliquer pour voir)</h3>
      </article>

      <article class="certif-card">
        <img src="/attestations/Pix.png" alt="Certification Pix — Compétences numériques" loading="lazy" width="512" height="512" />
        <h3>Pix</h3>
      </article>

      <article class="certif-card">
        <img src="/attestations/Anssi.png" alt="Visa de sécurité ANSSI — Agence nationale de la sécurité des systèmes d'information" loading="lazy" width="523" height="252" />
        <h3>ANSSI</h3>
      </article>
    </div>
    <p class="certif-cta">
      <a href="/attestations/ERA_Attestation.pdf" target="_blank" rel="noopener noreferrer">Voir l'attestation (PDF)</a>
    </p>
  </section>

  <section class="Hardskill">
    <h1>Hard Skills</h1>
    <div class="carousel" id="skills-carousel" tabindex="0" aria-label="Carrousel des compétences">
      <div class="carousel-track">
        <div class="skill">HTML</div>
        <div class="skill">CSS</div>
        <div class="skill">PHP</div>
        <div class="skill">Astro</div>
        <div class="skill">C#</div>
        <div class="skill">Python</div>
        <div class="skill">SQL</div>
        <div class="skill">SQL Serveur</div>
        <div class="skill">Github</div>
        <div class="skill">Linux</div>
        <div class="skill">Dotnet</div>
        <div class="skill">Transact-SQL</div>
        <div class="skill">Symphony</div>
      </div>
    </div>
    <p class="drag-hint" id="drag-hint" aria-hidden="true">Glissez avec la souris</p>
  </section>
  <section class="Softskill">
    <h1>Soft Skills</h1>
    <div class="softskill-grid">
      <div class="skill">Esprit d’équipe</div>
      <div class="skill">Curiosité</div>
      <div class="skill">Autonomie</div>
      <div class="skill">Capacité d’adaptation</div>
      <div class="skill">Communication</div>
      <div class="skill">Gestion du temps</div>
      <div class="skill">Sens de l’analyse</div>
      <div class="skill">Persévérance</div>
    </div>
    <section class="Langues">
      <h1>Langues</h1>
      <div class="softskill-grid">
        <div class="skill">Français</div>
        <div class="skill">Anglais</div>
      </div>
    </section>

    <section class="Interets">
      <h1>Centres d’intérêt</h1>
      <div class="softskill-grid">
        <div class="skill">Développement</div>
        <div class="skill">Lecture</div>
        <div class="skill">Jeux vidéo</div>
        <div class="skill">Cinéma</div>
      </div>
    </section>
  </section>

  <!-- Modal RGPD -->
  <div id="rgpd-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div class="carousel-container">
        <button class="prev" id="prevBtn">&#10094;</button>
        <div class="carousel-slides">
          {
            rgpdUrls.map((url, index) => (
              <div class="slide" data-index={index} style={index === 0 ? "display: block;" : "display: none;"}>
                <iframe src={url} width="100%" height="600px" style="border: none;" />
              </div>
            ))
          }
        </div>
        <button class="next" id="nextBtn">&#10095;</button>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Drag horizontal (souris + tactile + pointer)
  const carousel = document.getElementById("skills-carousel");
  let isDown = false;
  let startX: number | undefined;
  let scrollStart: number | undefined;

  const endDrag = () => {
    isDown = false;
    if (carousel) {
      carousel.classList.remove("dragging");
    }
  };

  if (carousel) {
    carousel.addEventListener("pointerdown", (e) => {
      isDown = true;
      startX = e.clientX;
      scrollStart = carousel.scrollLeft;
      carousel.classList.add("dragging");
      carousel.setPointerCapture(e.pointerId);
    });

    carousel.addEventListener("pointermove", (e) => {
      if (!isDown || startX === undefined || scrollStart === undefined) return;
      const dx = e.clientX - startX;
      carousel.scrollLeft = scrollStart - dx;
    });

    ["pointerup", "pointercancel", "pointerleave"].forEach((evt) => carousel.addEventListener(evt, endDrag));

    // Molette shift pour scroll horizontal (bonus)
    carousel.addEventListener(
      "wheel",
      (e) => {
        if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
          carousel.scrollLeft += e.deltaY;
          e.preventDefault();
        }
      },
      { passive: false },
    );

    // Navigation clavier (flèches)
    carousel.addEventListener("keydown", (e) => {
      const step = 120;
      if (e.key === "ArrowRight") {
        carousel.scrollBy({ left: step, behavior: "smooth" });
      }
      if (e.key === "ArrowLeft") {
        carousel.scrollBy({ left: -step, behavior: "smooth" });
      }
    });

    const hint = document.getElementById("drag-hint");
    if (carousel) {
      const hideHint = () => hint && hint.classList.add("hide");
      carousel.addEventListener("pointerdown", hideHint, { once: true });
      carousel.addEventListener(
        "keydown",
        (e) => {
          if ((e.key === "ArrowRight" || e.key === "ArrowLeft") && hint) hideHint();
        },
        { once: true },
      );
    }
  }

  // Modal RGPD : ouverture/fermeture
  const rgpdCard = document.getElementById("rgpd-card");
  const rgpdModal = document.getElementById("rgpd-modal");
  const closeModal = document.querySelector(".close");

  if (rgpdCard && rgpdModal && closeModal) {
    rgpdCard.addEventListener("click", () => {
      rgpdModal.style.display = "block";
    });

    closeModal.addEventListener("click", () => {
      rgpdModal.style.display = "none";
    });

    window.addEventListener("click", (event) => {
      if (event.target === rgpdModal) {
        rgpdModal.style.display = "none";
      }
    });
  }

  // Navigation carousel RGPD
  let currentSlide = 0;
  const slides = document.querySelectorAll(".slide");
  const updateSlideVisibility = () => {
    slides.forEach((slide, index) => {
      if (slide instanceof HTMLElement) {
        slide.style.display = index === currentSlide ? "block" : "none";
      }
    });
  };

  const nextBtn = document.getElementById("nextBtn");
  const prevBtn = document.getElementById("prevBtn");

  if (nextBtn) {
    nextBtn.addEventListener("click", () => {
      if (currentSlide < slides.length - 1) {
        currentSlide++;
        updateSlideVisibility();
      }
    });
  }

  if (prevBtn) {
    prevBtn.addEventListener("click", () => {
      if (currentSlide > 0) {
        currentSlide--;
        updateSlideVisibility();
      }
    });
  }
</script>

<style>
  /* Variables responsive pour tailles internes */
  :root {
    --fs-card-title: clamp(0.95rem, 0.7vw + 0.7rem, 1.25rem);
    --fs-card-role: clamp(0.75rem, 0.55vw + 0.55rem, 0.95rem);
    --fs-card-text: clamp(0.7rem, 0.5vw + 0.5rem, 0.85rem);
    --fs-skill: clamp(0.7rem, 0.55vw + 0.55rem, 0.95rem);
    --pad-card: clamp(0.8rem, 1.2vw + 0.4rem, 1.4rem);
    --pad-skill-x: clamp(0.8rem, 1.2vw + 0.3rem, 1.8rem);
    --pad-skill-y: clamp(0.55rem, 0.8vw + 0.25rem, 0.9rem);
  }

  /* Expériences (ajustement interne) */
  .experience-card {
    padding: var(--pad-card);
  }
  .experience-card h2 {
    font-size: var(--fs-card-title);
    letter-spacing: 0.5px;
  }
  .experience-card .role {
    font-size: var(--fs-card-role);
  }
  .experience-card ul {
    font-size: var(--fs-card-text);
    line-height: 1.25;
    margin-top: 0.25rem;
    padding-left: 1.05rem;
  }
  .experience-card ul li + li {
    margin-top: 0.25rem;
  }

  /* Grilles soft / langues / centres d’intérêt */
  .softskill-grid .skill {
    font-size: var(--fs-skill);
    padding: var(--pad-skill-y) var(--pad-skill-x);
    line-height: 1.15;
  }

  /* Carousel hard skills (on garde largeur mais ajuste font/padding) */
  .carousel-track .skill {
    font-size: var(--fs-skill);
    padding: var(--pad-skill-y) calc(var(--pad-skill-x) * 1.1);
    min-width: clamp(90px, 10vw, 140px);
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Harmonisation visuelle : même hauteur mentale */
  .softskill-grid .skill,
  .carousel-track .skill {
    font-weight: 600;
  }

  /* Petits écrans : resserrer */
  @media (max-width: 520px) {
    .experience-grid {
      gap: 0.9rem;
      padding: 1rem;
    }
    .experience-card ul {
      line-height: 1.2;
    }
  }

  /* Très petits écrans : si besoin passer temporairement en 1 colonne (décommente si souhaité) */
  /*
@media (max-width: 380px) {
  .experience-grid {
    grid-template-columns: 1fr;
  }
}
*/

  main section h1 {
    font-size: larger;
    text-align: center;
  }
  main section a {
    color: darkgrey;
  }
  main section h2 {
    font-size: 1rem;
    margin-top: 1rem;
    text-align: center;
  }
  main section h3 {
    font-size: 0.9rem;
    margin-left: 1rem;
  }

  .profil {
    margin-top: 3rem;
    text-align: center;
    & p {
      max-width: 800px;
    }
  }
  .profil a:hover {
    color: grey;
  }

  .icones {
    margin-top: 1rem;
    text-align: center;
    & a {
      text-decoration: none;
      color: darkgrey;
      transition: color 0.3s;
      &:hover {
        color: grey;
      }
    }
  }

  .Expériences {
    margin-top: 0rem;
  }

  .experience-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.2rem; /* augmenté légèrement */
    max-width: 760px; /* un peu plus large */
    margin: 0 auto;
    padding: 1.25rem; /* léger + */
  }

  .experience-card {
    background-color: #ffffff;
    border: 1px solid #ccc;
    border-radius: 18px; /* arrondi légèrement + */
    padding: 1.25rem 1.4rem; /* plus d’espace interne */
    box-shadow: 0 3px 7px rgba(0, 0, 0, 0.11);
    transition:
      transform 0.18s ease,
      box-shadow 0.35s ease;
    min-height: 150px; /* donne un peu d’air vertical */
  }
  .experience-card:hover {
    transform: translateY(-4px) scale(1.025);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.18);
  }
  .experience-card h2 {
    font-size: 1.1rem; /* + */
    margin: 0 0 0.4rem;
  }
  .experience-card .role {
    font-size: 0.85rem; /* + */
    margin: 0 0 0.6rem;
  }
  .experience-card ul {
    font-size: 0.8rem; /* + */
  }

  .Formation {
    margin-top: 3rem;
    text-align: center;
  }

  .formation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.2rem;
    max-width: 760px;
    margin: 0 auto;
    padding: 1.25rem;
  }

  .formation-card {
    background-color: #ffffff;
    border: 1px solid #ccc;
    border-radius: 18px;
    padding: 1.25rem 1.4rem;
    box-shadow: 0 3px 7px rgba(0, 0, 0, 0.11);
    transition:
      transform 0.18s ease,
      box-shadow 0.35s ease;
    min-height: 110px;
  }
  .formation-card:hover {
    transform: translateY(-4px) scale(1.025);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.18);
  }
  .formation-card h2 {
    font-size: var(--fs-card-title);
    margin: 0 0 0.4rem;
  }
  .formation-card .etab {
    font-size: var(--fs-card-role);
    color: #555;
    margin-bottom: 0.2rem;
  }
  .formation-card .annee {
    font-size: var(--fs-card-text);
    color: #777;
  }

  .Hardskill {
    margin-top: 3rem;
    text-align: center;
  }

  /* Certifications */
  .Certifications {
    margin-top: 3rem;
    text-align: center;
  }
  .certif-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.2rem;
    max-width: 900px;
    margin: 0 auto;
    padding: 1.25rem;
  }
  .certif-card {
    background-color: #ffffff;
    border: 1px solid #ccc;
    border-radius: 18px;
    padding: var(--pad-card);
    box-shadow: 0 3px 7px rgba(0, 0, 0, 0.11);
    transition:
      transform 0.18s ease,
      box-shadow 0.35s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 180px;
  }
  .certif-card:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.18);
  }
  .certif-card img {
    max-width: 100%;
    height: auto;
    object-fit: contain;
    aspect-ratio: auto;
    filter: saturate(0.95);
  }
  .certif-card h3 {
    font-size: var(--fs-card-role);
    margin-top: 0.6rem;
  }
  .certif-cta {
    margin-top: 0.25rem;
  }
  .certif-cta a {
    color: #555;
    text-decoration: underline;
  }
  .certif-cta a:hover {
    color: #333;
  }

  .carousel {
    overflow-x: auto;
    overflow-y: hidden;
    width: 100%;
    max-width: 600px;
    margin: 1rem auto;
    border: 1px solid #ccc;
    border-radius: 20px;
    background-color: #f5f5f5;
    scroll-behavior: smooth;
    scrollbar-width: none; /* Firefox */
    cursor: grab;
    -webkit-overflow-scrolling: touch;
  }
  .carousel.dragging {
    cursor: grabbing;
  }
  .carousel::-webkit-scrollbar {
    display: none;
  }

  .carousel-track {
    display: inline-flex;
    gap: 1rem;
    padding: 1rem;
    /* Suppression de l'animation auto:
       animation: scroll 20s linear infinite; (retiré) */
  }

  .skill {
    flex: 0 0 auto;
    background-color: #ffffff;
    border: 1px solid #ccc;
    border-radius: 15px;
    padding: 1rem 2rem;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    user-select: none;
  }

  .Softskill {
    margin-top: 3rem;
    text-align: center;
  }

  .softskill-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    max-width: 800px;
    margin: 1rem auto;
    padding: 1rem;
  }

  .softskill-grid .skill {
    background-color: #ffffff;
    border: 1px solid #ccc;
    border-radius: 15px;
    padding: 1rem;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  /* Ajout animation uniquement Soft Skills / Langues / Centres d’intérêt (pas le carousel) */
  .Softskill .softskill-grid .skill {
    transition:
      transform 0.15s ease,
      box-shadow 0.3s ease;
  }
  .Softskill .softskill-grid .skill:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
  }
  .Softskill .softskill-grid .skill:focus-visible {
    outline: 2px solid #888;
    outline-offset: 3px;
  }

  .drag-hint {
    font-size: 0.7rem;
    margin-top: 0.3rem;
    color: #666;
    opacity: 0.6;
    font-style: italic;
    letter-spacing: 0.5px;
    transition: opacity 0.35s ease;
    user-select: none;
  }
  .carousel.dragging + .drag-hint,
  .drag-hint.hide {
    opacity: 0;
  }

  /* Modal styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.8);
  }

  .modal-content {
    background-color: #fefefe;
    margin: 2% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 90%;
    max-width: 1000px;
    position: relative;
    border-radius: 8px;
  }

  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  .carousel-container {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .carousel-slides {
    width: 100%;
  }

  .slide {
    width: 100%;
    text-align: center;
  }

  .prev,
  .next {
    cursor: pointer;
    position: absolute;
    top: 50%;
    width: auto;
    padding: 16px;
    margin-top: -22px;
    color: #333;
    font-weight: bold;
    font-size: 18px;
    transition: 0.6s ease;
    border-radius: 0 3px 3px 0;
    user-select: none;
    background-color: rgba(200, 200, 200, 0.5);
    border: none;
    z-index: 10;
  }

  .next {
    right: 0;
    border-radius: 3px 0 0 3px;
  }

  .prev {
    left: 0;
    border-radius: 3px 0 0 3px;
  }

  .prev:hover,
  .next:hover {
    background-color: rgba(200, 200, 200, 0.8);
  }
</style>
